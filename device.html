<!DOCTYPE html>
<html lang="kr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="button.css" rel="stylesheet" type="text/css">
  <link href="device.css" rel="stylesheet" type="text/css">
  <link href="./assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <script src="chromata.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>
  <title>Chromata</title>
</head>

<body>
  <div id="container">
    <div>
      <video autoplay="true" id="videoElement"></video>
      <canvas id="canvas" style="display:none;"></canvas>
    </div>
    <div>
      <a style="cursor: pointer;" onclick="handleImageUpload()" title="Button push orange" class="button btnPush btnOrange">
        <i class="fas fa-camera fa-2x" style="color: #fbf9f9; vertical-align: middle;"></i>
      </a>
    </div>
  </div>
  <script>
    const video = document.querySelector("#videoElement");
    const canvas = document.querySelector("#canvas");
    const context = canvas.getContext("2d");

    if (navigator.mediaDevices.getUserMedia) {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(function (stream) {
          video.srcObject = stream;
        })
        .catch(function (error) {
          console.log(error.message);
        });
    }
    const displayWindow = window.open('display.html', target = "_blank")

    async function handleImageUpload() {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      const capturedImageURL = canvas.toDataURL('image/png');
      displayWindow.postMessage({ path: capturedImageURL }, '*');
    }

  </script>
</body>

</html>